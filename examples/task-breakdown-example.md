# 任务拆解示例

本文档展示使用 `create-task` 命令时，AI 如何自动拆解高层目标为子任务。

---

## 示例 1：实现用户认证系统

### 命令

```bash
/vibe create-task "实现用户认证系统"
```

### AI 拆解过程

1. **理解目标**：用户需要一个完整的认证系统
2. **分析需求**：包括注册、登录、权限验证
3. **识别关键步骤**：
   - 数据层：用户模型
   - API 层：注册和登录接口
   - 认证层：JWT 验证
   - 表现层：登录表单
4. **拆解为子任务**：确保每个任务独立、可验证

### 生成的子任务

```
正在分析目标：实现用户认证系统

任务拆解完成，已创建 5 个子任务：

  ✓ task-001.md - 设计用户数据库模型
    依赖：无
    预估时间：1-2 小时

  ✓ task-002.md - 实现用户注册 API
    依赖：task-001
    预估时间：2-3 小时

  ✓ task-003.md - 实现用户登录 API
    依赖：task-001, task-002
    预估时间：2-3 小时

  ✓ task-004.md - 添加 JWT 认证中间件
    依赖：task-002, task-003
    预估时间：1-2 小时

  ✓ task-005.md - 创建登录表单组件
    依赖：task-003, task-004
    预估时间：2-3 小时

子任务已按执行顺序排列，依赖关系清晰。
```

---

## 示例 2：实现文章发布功能

### 命令

```bash
/vibe create-task "实现文章发布功能"
```

### AI 拆解过程

1. **理解目标**：用户需要发布和展示文章
2. **分析需求**：包括创建、编辑、删除、列表
3. **识别关键步骤**：
   - 数据层：文章模型
   - API 层：CRUD 接口
   - 业务层：文章逻辑（草稿、发布）
   - 表现层：编辑器和列表
4. **拆解为子任务**

### 生成的子任务

```
正在分析目标：实现文章发布功能

任务拆解完成，已创建 6 个子任务：

  ✓ task-006.md - 设计文章数据库模型
    依赖：无
    预估时间：1-2 小时

  ✓ task-007.md - 实现文章创建 API
    依赖：task-006
    预估时间：2-3 小时

  ✓ task-008.md - 实现文章列表和详情 API
    依赖：task-006, task-007
    预估时间：2-3 小时

  ✓ task-009.md - 实现文章更新和删除 API
    依赖：task-007, task-008
    预估时间：2-3 小时

  ✓ task-010.md - 添加文章草稿和发布状态管理
    依赖：task-007, task-008, task-009
    预估时间：1-2 小时

  ✓ task-011.md - 创建文章编辑器组件
    依赖：task-008, task-009, task-010
    预估时间：3-4 小时

子任务已按执行顺序排列，依赖关系清晰。
```

---

## 示例 3：使用 --single 标志

### 命令

```bash
/vibe create-task "添加密码重置功能" --single
```

### 输出

```
已创建单任务：task-012.md
```

### 生成的任务文件

```markdown
## 目标

添加密码重置功能，支持用户通过邮箱重置密码。

## 输入

- 已有的用户模型（`/src/models/User.ts`）
- 已有的认证系统（`/src/services/auth.ts`）

## 输出

必须产生的文件、修改或成果：
- 添加密码重置 Token 字段到用户模型
- 实现发送重置邮件的功能
- 创建重置密码 API
- 创建重置密码页面
- 添加 Token 验证逻辑

## 完成条件

什么样的状态算完成：
- 用户可以请求密码重置
- 收到重置邮件
- 可以通过重置链接设置新密码
- 旧密码立即失效
- 功能测试通过
- 代码审查通过
```

---

## 任务拆解原则

### 1. 粒度适中

每个子任务应该在 1-4 小时内完成，过大或过小都不合适：

❌ **过大**：task-001 - 实现完整的文章管理系统
✅ **适中**：task-001 - 设计文章数据库模型
❌ **过小**：task-001 - 添加文章标题字段

### 2. 独立性

子任务之间尽量减少交叉依赖：

```markdown
## 输入

- 已有文件或资源
- 前置任务（依赖：task-001, task-002）
- 配置或环境要求
```

### 3. 可验证性

每个子任务都有明确的完成标准：

```markdown
## 完成条件

什么样的状态算完成：
- 功能测试通过
- 代码审查通过
- 文档已更新
- 相关任务已关联
```

### 4. 逻辑顺序

子任务按执行顺序排列，确保依赖关系正确：

```
task-001: 设计数据库模型（无依赖）
  ↓
task-002: 实现 API（依赖 task-001）
  ↓
task-003: 添加认证（依赖 task-002）
  ↓
task-004: 创建 UI（依赖 task-003）
```

---

## 何时使用自动拆解

### 适合自动拆解的场景：

✅ 复杂功能，需要多个步骤
✅ 大型目标，不确定如何拆分
✅ 新项目，没有清晰的规划
✅ 需要快速建立任务列表

### 适合单任务模式的场景：

✅ 明确的小功能（`--single`）
✅ 补充遗漏的细节
✅ 快速修复或优化
✅ 非常熟悉的工作内容

---

## 最佳实践

### 1. 从高层目标开始

```bash
# ✅ 好：从高层目标开始
/vibe create-task "实现用户认证系统"

# ❌ 避免：直接创建具体任务
/vibe create-task "添加用户模型的 email 字段"
```

### 2. 审查拆解结果

AI 拆解后，检查：
- 子任务是否合理？
- 是否有遗漏？
- 依赖关系是否正确？

### 3. 灵活调整

可以手动编辑任务文件，调整内容：

```bash
# 查看 AI 拆解的结果
cat .vibe/tasks/task-001.md

# 手动调整内容
vim .vibe/tasks/task-001.md
```

### 4. 使用主任务跟踪进度

对于复杂功能，创建主任务来跟踪所有子任务：

```markdown
## 子任务清单

- [x] task-001 - 设计用户数据库模型
- [x] task-002 - 实现用户注册 API
- [ ] task-003 - 实现用户登录 API
- [ ] task-004 - 添加 JWT 认证中间件
- [ ] task-005 - 创建登录表单组件

总体进度：40% (2/5)
```

---

## 总结

自动拆解功能让任务创建更智能、更高效：

- ✅ 从高层目标快速建立任务列表
- ✅ AI 确保子任务的逻辑性和可执行性
- ✅ 自动处理依赖关系和执行顺序
- ✅ 保留手动创建的灵活性

推荐的工作流：

1. 提供高层目标
2. 让 AI 自动拆解
3. 审查和调整
4. 按顺序执行子任务
